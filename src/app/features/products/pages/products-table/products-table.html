<!-- Message Notfication -->

<p-toast></p-toast>

@if (loading()) {
<div class="custom-loader-overlay">
  <div class="custom-loader"></div>
</div>
}

<!-- Table Header for Add and Filter-->
<div class="table-header">
  <button
    pButton
    label="New Record"
    icon="pi pi-plus"
    class="custom-add-button"
    (click)="onShowCreateDialog()"
  ></button>
  <span class="p-input-icon-left search-wrapper">
    <i class="pi pi-search"></i>
    <input
      pInputText
      type="text"
      placeholder="Search..."
      (input)="onFilterGlobal($event)"
      class="custom-search-input"
    />
  </span>
</div>

<!-- Table  -->
<p-table
  #dt
  [value]="data()"
  [resizableColumns]="true"
  [responsiveLayout]="'scroll'"
  [scrollable]="true"
  [paginator]="true"
  [rows]="10"
  [rowsPerPageOptions]="[10, 20, 50]"
  [globalFilterFields]="globalFilterFields()"
  selectionMode="single"
  (onRowSelect)="onRowSelectEvent($event)"
>
  <!-- Table Header -->
  <ng-template #header>
    <tr>
      @for (col of columns(); track col.field) {
      <th [pSortableColumn]="col.sortable ? col.field : undefined">
        {{ col.header }}
        @if (col.sortable) {
        <p-sortIcon [field]="col.field"></p-sortIcon>
        } @if (col.filterable) {
        <p-columnFilter
          type="text"
          [field]="col.field"
          placeholder="Filter by {{ col.header }}"
          ariaLabel="Filter {{ col.header }}"
          display="menu"
          styleClass="select-filter"
        ></p-columnFilter>
        }
      </th>
      }
      <th>Actions</th>
    </tr>
  </ng-template>

  <!-- Table Body -->
  <ng-template #body let-record>
    <tr [pSelectableRow]="record">
      @for (col of columns(); track $index) {
      <td>{{ record[col.field] }}</td>
      }
      <td>
        <button
          pButton
          icon="pi pi-pencil"
          class="p-button-text p-button-sm text-primary"
          (click)="onShowUpdateDialog(record)"
        ></button>
        <button
          pButton
          icon="pi pi-trash"
          class="p-button-text p-button-sm text-danger"
          (click)="confirmDelete(record.id)"
        ></button>
      </td>
    </tr>
  </ng-template>
</p-table>

<!-- Delete Dialog -->
<p-confirmDialog></p-confirmDialog>
